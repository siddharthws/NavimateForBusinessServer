<!-- Lead Report HTML -->
<div class="content-toolbar d-flex">
    <button class="btn btn-primary" ng-click="resetFilters(); applyFilters()">Clear Filters</button>
    <button class="btn btn-primary" ng-click="export()">Export</button>
    <button class="btn btn-primary" ng-click="init()">Sync</button>
    <button class="btn btn-primary" ng-click="toggleColumns()">Show/Hide Columns</button>
</div>

<div class="content-data full-flex">
    <table class="table table-bordered" ng-table="">
        <thead>
            <th>
                #
            </th>
            <th ng-repeat="column in columns" ng-show="column.show">
                <div class="dropdown dropdown-multiselect">
                    <button class="dropdown-toggle-button d-flex w-100" data-toggle="dropdown">
                        <span class="full-flex">{{column.title}}</span>
                        <img class="img-icon ml-2" src="/static/images/icon_filter.png"
                             ng-show="((((column.type == 'radioList') || (column.type == 'selection')) && (filter.selection[column.title].unselected.length == 0)) ||
                                      ((column.type == 'text') && !filter.text[column.title].search) ||
                                      ((column.type == 'number') && !(filter.number[column.title].lesserThan || filter.number[column.title].greaterThan)) ||
                                      ((column.type == 'date') && !(filter.date[column.title].from || filter.date[column.title].to))) &&
                                      ((filter.sort.indexOf(column.title) == -1) && (filter.sort.indexOf('-' + column.title) == -1))"/>
                        <img class="img-icon ml-2" src="/static/images/icon_filter_active.png"
                             ng-show="(((column.type == 'radioList') || (column.type == 'selection')) && (filter.selection[column.title].unselected.length > 0)) ||
                                      ((column.type == 'text') && filter.text[column.title].search) ||
                                      ((column.type == 'number') && (filter.number[column.title].lesserThan || filter.number[column.title].greaterThan)) ||
                                      ((column.type == 'date') && (filter.date[column.title].from || filter.date[column.title].to)) ||
                                      ((filter.sort.indexOf(column.title) != -1) || (filter.sort.indexOf('-' + column.title) != -1))"/>
                    </button>
                    <div class="dropdown-menu p-2">
                        <div ng-show="column.type != 'text'">
                            <span>Sort:</span>
                            <div class="d-flex justify-content-center">
                                <input type="button" value="" class="image-button ib-sort-down" ng-click="filterSort(column.title, false)"
                                       ng-class="{'active' : filter.sort.indexOf(column.title) != -1}"/>
                                <input type="button" value="" class="image-button ib-sort-up" ng-click="filterSort(column.title, true)"
                                       ng-class="{'active' : filter.sort.indexOf('-' + column.title) != -1}"/>
                            </div>
                        </div>

                        <div ng-show="column.type == 'selection' || column.type == 'radioList'">
                            <span>Select:</span>
                            <input type="text" ng-model="filter.search[column.title]" placeholder="Search..." class="input-underlined">
                            <div ng-repeat="value in filter.selection[column.title].options | filter:filter.search[column.title]">
                                <input type="checkbox" ng-checked="filter.selection[column.title].unselected.indexOf(value) == -1"
                                       ng-click="filterSelect(column.title, value)"/>
                                {{value}}
                            </div>
                        </div>

                        <div ng-show="column.type == 'text'">
                            <input type="text" placeholder="Search..." ng-model-options="{debounce: 500}" class="input-underlined"
                                   ng-model="filter.text[column.title].search" ng-change="applyFilters()">
                        </div>

                        <div ng-show="column.type == 'number'">
                            <span>Range:</span>
                            <div class="d-flex align-items-center">
                                <span> <= </span>
                                <input type="number" placeholder="Less than" class="input-underlined"
                                       ng-model="filter.number[column.title].lesserThan" ng-model-options="{debounce: 500}"
                                       ng-change="applyFilters()" >
                            </div>
                            <div class="d-flex align-items-center">
                                <span> >= </span>
                                <input type="number" placeholder="Greater than" class="input-underlined"
                                       ng-model="filter.number[column.title].greaterThan" ng-model-options="{debounce: 500}"
                                       ng-change="applyFilters()" >
                            </div>
                        </div>

                        <div ng-show="column.type == 'date'">
                            <span>Range:</span>
                            <md-datepicker ng-model="fromDate" md-placeholder="From Date"
                                           ng-change="fromDateUpdate(fromDate, column.title)"></md-datepicker>
                            <md-datepicker ng-model="toDate" md-placeholder="To Date"
                                           ng-change="toDateUpdate(toDate, column.title)"></md-datepicker>
                        </div>
                    </div>
                </div>
            </th>
        </thead>
        <tr ng-repeat="row in filteredValues">
            <td class="text-center">
                {{$index + 1}}
            </td>
            <td class="text-center" ng-repeat="column in columns" ng-show="column.show">
                <div ng-show="(column.type == 'text') ||
                              (column.type == 'number') ||
                              (column.type == 'radioList') ||
                              (column.type == 'checkList') ||
                              (column.type == 'selection') ||
                              (column.type == 'date') ||
                              (filteredValues[$parent.$index][column.title] == '-')">
                    {{filteredValues[$parent.$index][column.title]}}
                </div>
                <input type="button" value=""
                       ng-show="((column.type == 'photo') ||
                                 (column.type == 'signature')) &&
                                 (filteredValues[$parent.$index][column.title] != '-')"
                       class="image-button ib-small ib-link"
                       ng-click="showImage(filteredValues[$parent.$index][column.title])"/>
                <input type="button" value=""
                       ng-show="(column.type == 'location') &&
                                (filteredValues[$parent.$index][column.title] != '-')"
                       class="image-button ib-small ib-map"
                       ng-click="showLocation(filteredValues[$parent.$index][column.title])"/>
            </td>
        </tr>
    </table>
</div>